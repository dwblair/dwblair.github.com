<!DOCTYPE html>
<!-- saved from url=(0032)http://www.donblair.cc/circles1/ -->
<html lang="en"><!-- for RTL change to: "he-IL" or "ar" ect. --><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
	<title>donblair.cc</title>
	<link rel="stylesheet" href="http://www.donblair.cc/circles1/css/squaresNoBorder.css">
 <script type="text/javascript" src="./processing-1.3.6.js"></script>

    <!--
        This is a source-file-less sketch, loaded from inline source code in
        the html header. This only works if the script specifies a data-processing-target
    -->
    <script type="text/processing" data-processing-target="targetcanvas">


int xspacing = 4;   // How far apart should each horizontal location be spaced
int w;              // Width of entire wave

float theta = 0.0;  // Start angle at 0
float amplitude = 75.0;  // Height of wave
float period = 500.0;  // How many pixels before the wave repeats
float dx;  // Value for incrementing X, a function of period and xspacing
float[] yvalues;  // Using an array to store height values for the wave

//float yOffset = 
float archiveSizeInitially=200;
float archiveDeadPoint=5;

float recoveryPoint=3;
float recoverY=10;

HScrollbar hs1, hs2;  // Two scrollbars
//PFont myFont;

void setup() {
  size(640, 360);
  w = width+16;
  dx = (TWO_PI / period) * xspacing;
  yvalues = new float[w/xspacing];
  calcWave();
  //frameRate(3);
  
  hs1 = new HScrollbar(0, 40, width, 16, 16);
  hs2 = new HScrollbar(0, 100, width, 16, 16);
  myFont=createFont("FFScala",11);
  textFont(myFont);
}

void draw() {
  background(0);
 
  
  //archiveDeadPoint=archiveDeadPoint+2;
  //if (archiveDeadPoint>20) archiveDeadPoint = 5;
  
  hs1.update();
  hs2.update();
  hs1.display();
  hs2.display();
  
  fill(255);
  text("year of total obsolescence",10,43);
  text("year of digitization intervention",10,103);
  
  archiveDeadPoint=hs1.getPos()/width*20;
  recoveryPoint=hs2.getPos()/width*8;
   calcWave();
  renderWave();
  //println(hs1.getPos());
  //println(recoveryPoint);
   fill(255);
   text("year of total obsolescence",10,43);
  text("year of digitization intervention",10,103);
  text("% archive preserved:",10,163);
   
  //int r
  float recoveredNum=(height-recoverY-183.)/archiveSizeInitially*(1/.87)*100.;
  if (recoveredNum<0) {
    recoveredNum=0;
  }
  String rn = nf(recoveredNum,1,1);
  text(rn,140,163);
  //text("%",170,150);
  
}


void calcWave() {
  // Increment theta (try different values for 'angular velocity' here
  //theta += 0.02;

  // For every x value, calculate a y value with sine function
  float x = theta;
  
  float B=archiveSizeInitially;
  float A=2*B;
  float C=archiveDeadPoint*dx/log(2.);
  recoverY = A+B*exp(recoveryPoint/C);
  
  for (int i = 0; i < yvalues.length; i++) {
    //yvalues[i] = sin(x)*amplitude;
    
    B=1;
    A=2*B;
    //C=.2;
    
    yvalues[i] = A+B*exp(x/C);
    //println(x);
    //println(recoveryPoint);
    if (x>recoveryPoint) {
      
      recoverY = A+B*exp(recoveryPoint/C);
      float fR=150;
      yvalues[i]=recoverY;
      //yvalues[i]=(recoverY-fR)*exp(-(x-recoveryPoint)/30.)+fR;
      
    }
    x+=dx;
  }
}

void renderWave() {
  noStroke();
  fill(255,0,0);
  //stroke(255,0,0);
  // A simple way to draw the wave with an ellipse at each location
  for (int x = 0; x < yvalues.length-1; x++) {
    //if (x*xspacing/width*8>recoveryPoint) fill(255,0,0);
    if (float(x)*float(xspacing)/width*8>recoveryPoint) {
      fill(0,255,0);
      stroke(0,255,0);
    }
    ellipse(x*xspacing, height/2+yvalues[x], 4, 4);
    //print(float(x)*float(xspacing)/width*8);
    //print(" ");
    //println(recoveryPoint);
    //stroke(255);
    //line(x*xspacing,height/2+yvalues[x],(x+1)*xspacing,height/2+yvalues[x+1]);
  }
  
  
}

class HScrollbar {
  int swidth, sheight;    // width and height of bar
  float xpos, ypos;       // x and y position of bar
  float spos, newspos;    // x position of slider
  float sposMin, sposMax; // max and min values of slider
  int loose;              // how loose/heavy
  boolean over;           // is the mouse over the slider?
  boolean locked;
  float ratio;

  HScrollbar (float xp, float yp, int sw, int sh, int l) {
    swidth = sw;
    sheight = sh;
    int widthtoheight = sw - sh;
    ratio = (float)sw / (float)widthtoheight;
    xpos = xp;
    ypos = yp-sheight/2;
    spos = xpos + swidth/2 - sheight/2;
    newspos = spos;
    sposMin = xpos;
    sposMax = xpos + swidth - sheight;
    loose = l;
  }

  void update() {
    if(overEvent()) {
      over = true;
    } else {
      over = false;
    }
    if(mousePressed && over) {
      locked = true;
    }
    if(!mousePressed) {
      locked = false;
    }
    if(locked) {
      newspos = constrain(mouseX-sheight/2, sposMin, sposMax);
    }
    if(abs(newspos - spos) > 1) {
      spos = spos + (newspos-spos)/loose;
    }
  }

  float constrain(float val, float minv, float maxv) {
    return min(max(val, minv), maxv);
  }

  boolean overEvent() {
    if(mouseX > xpos && mouseX < xpos+swidth &&
       mouseY > ypos && mouseY < ypos+sheight) {
      return true;
    } else {
      return false;
    }
  }

  void display() {
    noStroke();
    fill(204);
    rect(xpos, ypos, swidth, sheight);
    if(over || locked) {
      fill(0, 0, 0);
    } else {
      fill(102, 102, 102);
    }
    rect(spos, ypos, sheight, sheight);
  }

  float getPos() {
    // Convert spos to be values between
    // 0 and the total width of the scrollbar
    return spos * ratio;
  }
}

 </script>
<div class="square">
<!--<center><a href="http://donblair.org/"><img src="images/plainIsing.png" alt="test" width=180 height=180> </a></center>-->
<center>
<canvas id="targetcanvas" style="border: 1px solid black; image-rendering: -webkit-optimize-contrast !important; " tabindex="0" width="250" height="290"></canvas></center>
</div>
<!--
<p>
In order for the simulation to run, a file called "processing-1.3.6.js" needs to be in the same directory as the html file. You can download it via "right click save-as" <a href="processing-1.3.6.js">here</a>.
</p>
-->



<span style="position: absolute; top: 0px; left: 0px; opacity: 0; font-family: PjsEmptyFont, fantasy; ">AAAAAAAA</span>



</body></html>
